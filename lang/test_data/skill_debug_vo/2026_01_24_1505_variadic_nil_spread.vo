package main

// Test: Variadic functions with nil and empty slice spread

func sumInts(vals ...int) int {
	sum := 0
	for _, v := range vals {
		sum += v
	}
	return sum
}

func joinStrings(sep string, strs ...string) string {
	if len(strs) == 0 {
		return ""
	}
	result := strs[0]
	for i := 1; i < len(strs); i++ {
		result += sep + strs[i]
	}
	return result
}

func countAny(vals ...any) int {
	return len(vals)
}

// Test 1: Spread nil slice
func testSpreadNilSlice() {
	var s []int = nil
	result := sumInts(s...)
	assert(result == 0, "spread nil slice")
}

// Test 2: Spread empty slice
func testSpreadEmptySlice() {
	s := []int{}
	result := sumInts(s...)
	assert(result == 0, "spread empty slice")
}

// Test 3: Spread non-empty slice
func testSpreadNonEmptySlice() {
	s := []int{1, 2, 3, 4, 5}
	result := sumInts(s...)
	assert(result == 15, "spread non-empty slice")
}

// Test 4: No arguments to variadic
func testNoArgsVariadic() {
	result := sumInts()
	assert(result == 0, "no args variadic")
}

// Test 5: Spread string slice
func testSpreadStringSlice() {
	strs := []string{"a", "b", "c"}
	result := joinStrings("-", strs...)
	assert(result == "a-b-c", "spread string slice")
}

// Test 6: Spread nil string slice
func testSpreadNilStringSlice() {
	var strs []string = nil
	result := joinStrings("-", strs...)
	assert(result == "", "spread nil string slice")
}

// Test 7: Spread any slice
func testSpreadAnySlice() {
	vals := []any{1, "hello", true}
	result := countAny(vals...)
	assert(result == 3, "spread any slice")
}

// Test 8: Spread nil any slice
func testSpreadNilAnySlice() {
	var vals []any = nil
	result := countAny(vals...)
	assert(result == 0, "spread nil any slice")
}

// Test 9: Mixed regular args and spread
func testMixedArgsSpread() {
	s := []int{3, 4, 5}
	// Can't mix regular args with spread in Go/Vo
	// Just test spread alone
	result := sumInts(s...)
	assert(result == 12, "mixed args spread")
}

// Test 10: Spread slice from function return
func getSlice() []int {
	return []int{10, 20, 30}
}

func testSpreadFuncReturn() {
	result := sumInts(getSlice()...)
	assert(result == 60, "spread func return")
}

// Test 11: Spread slice from method
type SliceHolder struct {
	data []int
}

func (h SliceHolder) GetData() []int {
	return h.data
}

func testSpreadMethodReturn() {
	h := SliceHolder{data: []int{5, 10, 15}}
	result := sumInts(h.GetData()...)
	assert(result == 30, "spread method return")
}

// Test 12: Spread type assertion result
func testSpreadTypeAssert() {
	var a any = []int{2, 4, 6}
	result := sumInts(a.([]int)...)
	assert(result == 12, "spread type assert")
}

// Test 13: Variadic with single element spread
func testSingleElemSpread() {
	s := []int{42}
	result := sumInts(s...)
	assert(result == 42, "single elem spread")
}

// Test 14: Nested variadic call
func wrapSum(vals ...int) int {
	return sumInts(vals...)
}

func testNestedVariadicSpread() {
	s := []int{1, 2, 3}
	result := wrapSum(s...)
	assert(result == 6, "nested variadic spread")
}

// Test 15: Spread in deferred call
func testDeferSpread() {
	result := 0
	s := []int{7, 8, 9}
	
	func() {
		defer func() {
			result = sumInts(s...)
		}()
	}()
	
	assert(result == 24, "defer spread")
}

func main() {
	testSpreadNilSlice()
	testSpreadEmptySlice()
	testSpreadNonEmptySlice()
	testNoArgsVariadic()
	testSpreadStringSlice()
	testSpreadNilStringSlice()
	testSpreadAnySlice()
	testSpreadNilAnySlice()
	testMixedArgsSpread()
	testSpreadFuncReturn()
	testSpreadMethodReturn()
	testSpreadTypeAssert()
	testSingleElemSpread()
	testNestedVariadicSpread()
	testDeferSpread()
	println("PASS")
}
