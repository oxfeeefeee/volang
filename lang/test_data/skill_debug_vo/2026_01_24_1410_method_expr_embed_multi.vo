package main

// Test: Method expression with multi-level embedding

type Base struct {
	val int
}

func (b Base) GetVal() int {
	return b.val
}

func (b *Base) SetVal(v int) {
	b.val = v
}

type Middle struct {
	Base
	extra string
}

type Outer struct {
	Middle
	name string
}

// Test 1: Method expression on deeply embedded type
func testMethodExprDeepEmbed() {
	o := Outer{
		Middle: Middle{
			Base:  Base{val: 42},
			extra: "mid",
		},
		name: "outer",
	}
	
	// Method expression through embedding
	f := Outer.GetVal
	result := f(o)
	assert(result == 42, "method expr deep embed")
}

// Test 2: Pointer method expression on embedded type
func testPtrMethodExprEmbed() {
	o := &Outer{
		Middle: Middle{
			Base:  Base{val: 10},
			extra: "mid",
		},
		name: "outer",
	}
	
	// Pointer method expression
	f := (*Outer).SetVal
	f(o, 99)
	assert(o.val == 99, "ptr method expr embed")
}

// Test 3: Method value on embedded field
func testMethodValueEmbed() {
	o := Outer{
		Middle: Middle{
			Base:  Base{val: 5},
			extra: "mid",
		},
		name: "outer",
	}
	
	f := o.GetVal
	result := f()
	assert(result == 5, "method value embed")
}

// Test 4: Chained method expression call
func testChainedMethodExpr() {
	o := Outer{
		Middle: Middle{
			Base:  Base{val: 7},
			extra: "mid",
		},
		name: "outer",
	}
	
	// Direct call with method expression
	result := Outer.GetVal(o)
	assert(result == 7, "chained method expr")
}

// Test 5: Method expression with interface
type Getter interface {
	GetVal() int
}

func testMethodExprInterface() {
	o := Outer{
		Middle: Middle{
			Base:  Base{val: 33},
			extra: "mid",
		},
		name: "outer",
	}
	
	var g Getter = o
	f := g.GetVal
	result := f()
	assert(result == 33, "method expr interface")
}

// Test 6: Slice of embedded structs with method expression
func testSliceMethodExpr() {
	outers := []Outer{
		{Middle: Middle{Base: Base{val: 1}}},
		{Middle: Middle{Base: Base{val: 2}}},
		{Middle: Middle{Base: Base{val: 3}}},
	}
	
	sum := 0
	f := Outer.GetVal
	for _, o := range outers {
		sum += f(o)
	}
	assert(sum == 6, "slice method expr")
}

func main() {
	testMethodExprDeepEmbed()
	testPtrMethodExprEmbed()
	testMethodValueEmbed()
	testChainedMethodExpr()
	testMethodExprInterface()
	testSliceMethodExpr()
	println("PASS")
}
