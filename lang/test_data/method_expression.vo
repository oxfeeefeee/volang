// Test: method values and method expressions
package main


import "fmt"
type Counter struct {
    value int
}

func (c Counter) Get() int {
    return c.value
}

func (c Counter) Add(n int) int {
    return c.value + n
}

func (c *Counter) Increment() {
    c.value += 1
}

func main() {
    // Test 1: Method value from value receiver
    c := Counter{value: 10}
    getFunc := c.Get  // bound method value
    result := getFunc()
    assert(result == 10, "method value c.Get failed")
    
    // Test 2: Method value with argument
    addFunc := c.Add
    result2 := addFunc(5)
    assert(result2 == 15, "method value c.Add(5) failed")
    
    // Test 3: Method value stored and called later
    c2 := Counter{value: 200}
    fn := c2.Get
    c2.value = 300  // change original
    // Method value captures receiver at binding time for value receiver
    val := fn()
    assert(val == 200, "method value captures value at binding time")
    
    // Test 4: Method value passed as argument
    apply := func(f func() int) int {
        return f()
    }
    c4 := Counter{value: 42}
    res := apply(c4.Get)
    assert(res == 42, "method value as argument failed")
    
    // Test 5: Method value in slice
    c5 := Counter{value: 10}
    c6 := Counter{value: 20}
    c7 := Counter{value: 30}
    funcs := []func() int{c5.Get, c6.Get, c7.Get}
    assert(funcs[0]() == 10, "funcs[0]")
    assert(funcs[1]() == 20, "funcs[1]")
    assert(funcs[2]() == 30, "funcs[2]")
    
    // Test 6: Pointer receiver method values
    c8 := &Counter{value: 100}
    incFunc := c8.Increment
    incFunc()
    assert(c8.value == 101, "pointer receiver method value should mutate")
    
    // Test 7: Method expression - value receiver (T.Method)
    f1 := Counter.Get
    c9 := Counter{value: 50}
    result7 := f1(c9)
    assert(result7 == 50, "Counter.Get method expr failed")
    
    // Test 8: Method expression - pointer receiver ((*T).Method)
    f2 := (*Counter).Increment
    c10 := &Counter{value: 200}
    f2(c10)
    assert(c10.value == 201, "(*Counter).Increment method expr failed")
    
    // Test 9: Method expression with arguments
    f3 := Counter.Add
    c11 := Counter{value: 10}
    result9 := f3(c11, 25)
    assert(result9 == 35, "Counter.Add method expr failed")
    
    // Test 10: Method expression stored in struct field
    type FuncHolder struct {
        fn func(Counter) int
    }
    holder := FuncHolder{fn: Counter.Get}
    c12 := Counter{value: 77}
    result10 := holder.fn(c12)
    assert(result10 == 77, "method expr in struct field failed")
    
    // Test 11: Method expression in slice
    funcsExpr := []func(Counter) int{Counter.Get}
    c13 := Counter{value: 99}
    assert(funcsExpr[0](c13) == 99, "method expr in slice failed")
    
    fmt.Println("method_expression: ok")
}
