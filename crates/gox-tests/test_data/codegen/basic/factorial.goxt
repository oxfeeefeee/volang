# Factorial test: factorial(5) = 120

module factorial

# factorial(n) - recursive
func factorial
  params 1 1
  locals 6
  returns 1
  # r0 = n (input)
  # r1 = 1
  0: LoadInt r1, 1
  # r2 = (n <= 1)
  1: LeI64 r2, r0, r1
  # if r2: jump to return 1 (offset 5: pc becomes 3, then 3+5-1=7)
  2: JumpIf r2, 5
  # r3 = n - 1
  3: SubI64 r3, r0, r1
  # r4 = factorial(r3)
  4: Call 0, r3, 1, 1
  # r5 = n * r3 (result stored back at arg pos)
  5: MulI64 r5, r0, r3
  # return r5
  6: Return r5, 1
  # return 1
  7: Return r1, 1
end

func main
  locals 10
  # r0 = 5
  0: LoadInt r0, 5
  # r1 = factorial(r0) - Call func_id=0, arg_reg=r0, arg_count=1, ret_count=1
  1: Call 0, r0, 1, 1
  # print r0 (result)
  2: DebugPrint r0
  3: Return r0, 0
end

entry main
